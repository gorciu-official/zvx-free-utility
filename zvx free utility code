import os
import ctypes
import subprocess
import winreg
import sys
import time

class ZVX_Data:
    V = "1.0"
    N = "ZVX Free Tweaking Utility Panel"
    C1 = '\033[96m'
    C2 = '\033[95m'
    C3 = '\033[97m'
    END = '\033[0m'

def is_admin():
    return ctypes.windll.shell32.IsUserAnAdmin() != 0

def run(cmd):
    try:
        subprocess.run(cmd, shell=True, check=True, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
    except: pass

def s_reg(key, sub_key, name, value, rtype=winreg.REG_DWORD):
    try:
        winreg.CreateKey(key, sub_key)
        with winreg.OpenKey(key, sub_key, 0, winreg.KEY_WRITE) as k:
            winreg.SetValueEx(k, name, 0, rtype, value)
    except: pass

def ui():
    os.system('cls')
    print(f"{ZVX_Data.C1}   ◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤")
    print(f"{ZVX_Data.C3}      {ZVX_Data.N} v{ZVX_Data.V}")
    print(f"{ZVX_Data.C1}   ◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣◥◣{ZVX_Data.END}\n")

def m1():
    run('powershell -Command "Enable-ComputerRestore -Drive \'C:\'"')
    run('powershell -Command "Checkpoint-Computer -Description \'ZVX_Full\' -RestorePointType \'MODIFY_SETTINGS\'"')
    m2(); m3(); m4(); m5()

def m2():
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Microsoft\Windows\Dwm", "OverlayTestMode", 5)
    s_reg(winreg.HKEY_CURRENT_USER, r"Control Panel\Mouse", "MouseSpeed", "0", winreg.REG_SZ)
    s_reg(winreg.HKEY_CURRENT_USER, r"Control Panel\Mouse", "MouseThreshold1", "0", winreg.REG_SZ)
    s_reg(winreg.HKEY_CURRENT_USER, r"Control Panel\Mouse", "MouseThreshold2", "0", winreg.REG_SZ)
    s_reg(winreg.HKEY_CURRENT_USER, r"Control Panel\Accessibility\Keyboard Response", "DelayBeforeAcceptance", "0", winreg.REG_SZ)
    s_reg(winreg.HKEY_CURRENT_USER, r"Control Panel\Keyboard", "KeyboardDelay", "0", winreg.REG_SZ)
    s_reg(winreg.HKEY_CURRENT_USER, r"Control Panel\Keyboard", "KeyboardSpeed", "31", winreg.REG_SZ)
    s_reg(winreg.HKEY_CURRENT_USER, r"System\GameConfigStore", "GameDVR_FSEBehaviorMode", 2)
    s_reg(winreg.HKEY_CURRENT_USER, r"System\GameConfigStore", "GameDVR_Enabled", 0)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Policies\Microsoft\Windows\GameDVR", "AllowGameDVR", 0)
    run('bcdedit /set disabledynamictick yes')
    run('bcdedit /set useplatformclock no')
    run('bcdedit /set tscsyncpolicy Enhanced')

def m3():
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Policies\Microsoft\Windows\DataCollection", "AllowTelemetry", 0)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Policies\Microsoft\Windows\AppCompat", "AITEnable", 0)
    s_reg(winreg.HKEY_CURRENT_USER, r"Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager", "PreInstalledAppsEnabled", 0)
    s_reg(winreg.HKEY_CURRENT_USER, r"Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager", "SilentInstalledAppsEnabled", 0)
    s_reg(winreg.HKEY_CURRENT_USER, r"Software\Microsoft\Windows\CurrentVersion\ContentDeliveryManager", "SystemPaneSuggestionsEnabled", 0)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Policies\Microsoft\Windows\Windows Search", "AllowCortana", 0)
    s_reg(winreg.HKEY_CURRENT_USER, r"Software\Microsoft\Windows\CurrentVersion\BackgroundAccessApplications", "GlobalUserDisabled", 1)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Policies\Microsoft\Windows\Personalization", "NoLockScreen", 1)
    s_reg(winreg.HKEY_CURRENT_USER, r"Software\Microsoft\Windows\CurrentVersion\UserProfileEngagement", "ScoobeSystemSettingEnabled", 0)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\DataCollection", "AllowTelemetry", 0)
    svs = ["SysMain", "DiagTrack", "dmwappushservice", "WerSvc", "PcaSvc", "MapsBroker", "WbioSrvc", "XblAuthManager", "XblGameSave", "XboxNetApiSvc"]
    for s in svs:
        run(f'sc stop "{s}"')
        run(f'sc config "{s}" start= disabled')

def m4():
    run('powercfg /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c')
    run('powercfg -h off')
    run('powercfg /setacvalueindex SCHEME_CURRENT SUB_PROCESSOR PROCTHROTTLEMIN 100')
    run('powercfg /setacvalueindex SCHEME_CURRENT SUB_PROCESSOR PROCTHROTTLEMAX 100')
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile", "NetworkThrottlingIndex", 0xFFFFFFFF)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile", "SystemResponsiveness", 0)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games", "GPU Priority", 8)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games", "Priority", 6)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games", "Scheduling Category", "High", winreg.REG_SZ)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management", "DisablePagingExecutive", 1)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management", "LargeSystemCache", 1)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SYSTEM\CurrentControlSet\Control\PriorityControl", "Win32PrioritySeparation", 38)
    s_reg(winreg.HKEY_LOCAL_MACHINE, r"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games", "Affinity", 0)

def m5():
    run('ipconfig /flushdns')
    run('ipconfig /registerdns')
    run('ipconfig /release')
    run('ipconfig /renew')
    run('netsh winsock reset')
    run('del /s /f /q %temp%\\*.*')
    run('del /s /f /q C:\\Windows\\Temp\\*.*')
    run('del /s /f /q C:\\Windows\\Prefetch\\*.*')
    run('powershell "Get-PnpDevice | ? Status -eq Unknown | foreach { pnputil /remove-device $_.InstanceId }"')
    run('cleanmgr.exe /sagerun:1')

def start():
    if not is_admin():
        sys.exit()

    while True:
        ui()
        print(f"   {ZVX_Data.C2}[1]{ZVX_Data.C3} ALL OPTIMIZATIONS")
        print(f"   {ZVX_Data.C2}[2]{ZVX_Data.C3} INPUT DELAY & LATENCY")
        print(f"   {ZVX_Data.C2}[3]{ZVX_Data.C3} DEBLOAT & PRIVACY")
        print(f"   {ZVX_Data.C2}[4]{ZVX_Data.C3} HARDWARE & POWER")
        print(f"   {ZVX_Data.C2}[5]{ZVX_Data.C3} SYSTEM CLEANER")
        print(f"   {ZVX_Data.C2}[Q]{ZVX_Data.C3} EXIT")
        
        i = input(f"\n   {ZVX_Data.C1}» {ZVX_Data.END}").upper()

        if i == '1':
            m1(); input("\n   Finished. Press Enter...")
        elif i == '2':
            m2(); input("\n   Finished. Enter...")
        elif i == '3':
            m3(); input("\n   Finished. Enter...")
        elif i == '4':
            m4(); input("\n   Finished. Enter...")
        elif i == '5':
            m5(); input("\n   Finished. Enter...")
        elif i == 'Q':
            break

if __name__ == "__main__":
    start()
